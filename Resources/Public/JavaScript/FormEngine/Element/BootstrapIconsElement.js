/*! typo3-extension-bootstrap 2022-03-03 */
define(function(){return class{constructor(t,e){let n=this;this.configurations=JSON.parse(e),this.currentConfiguration=null,this.icons=[],this.currentIconSet="",this.currentValue="",this.currentPosition="",this.currentSize="",this.currentColor="",this.userControlFieldValue=document.getElementById(t+"-hidden"),this.userControlIconSet=document.getElementById(t+"-iconset"),this.userControlValue=document.getElementById(t+"-value"),this.userControlPosition=document.getElementById(t+"-position"),this.userControlSize=document.getElementById(t+"-size"),this.userControlColor=document.getElementById(t+"-color"),this.userControlFilter=document.getElementById(t+"-filter"),this.iconsContainer=document.getElementById(t+"-container"),this.previewContainer=document.getElementById(t+"-icon-preview"),this.removeButton=document.getElementById(t+"-remove"),this.removeButton.addEventListener("click",function(){n.currentValue="",n.updateValues()}),this.userControlIconSet.addEventListener("change",function(){n.currentIconSet=n.userControlIconSet.value,n.initIconSet()}),this.userControlPosition&&this.userControlPosition.addEventListener("change",function(){n.currentPosition=n.userControlPosition.value,n.updateValues()}),this.userControlSize&&this.userControlSize.addEventListener("change",function(){n.currentSize=n.userControlSize.value,n.updateValues()}),this.userControlColor&&this.userControlColor.addEventListener("change",function(){n.currentColor=n.userControlColor.value,n.updateValues()}),this.initValues()}initValues(){var t=this.userControlFieldValue.value?this.userControlFieldValue.value.split(";"):["","","","",""];this.currentIconSet="string"==typeof t[0]&&"default"!==t[0]?t[0]:"",this.currentValue="string"==typeof t[1]&&"default"!==t[1]?t[1]:"",this.currentPosition="string"==typeof t[2]&&"default"!==t[2]?t[2]:"",this.currentSize="string"==typeof t[3]&&"default"!==t[3]?t[3]:"",this.currentColor="string"==typeof t[4]&&"default"!==t[4]?t[4]:"",this.currentIconSet||"string"==typeof this.configurations[0].key&&(this.currentIconSet=this.configurations[0].key,this.userControlIconSet.value=this.currentIconSet),this.currentValue&&(this.userControlValue.value=this.currentValue,this.createPreviewIcon()),this.currentPosition&&this.userControlPosition&&(this.userControlPosition.value=this.currentPosition),this.currentSize&&this.userControlSize&&(this.userControlSize.value=this.currentSize),this.currentColor&&this.userControlColor&&(this.userControlColor.value=this.currentColor),this.initIconSet()}updateValues(){this.userControlValue.value=this.currentValue,this.userControlFieldValue.value=this.currentIconSet+";"+this.currentValue+";"+this.currentPosition+";"+this.currentSize+";"+this.currentColor,this.createPreviewIcon()}initCurrentConfiguration(){this.currentConfiguration=null;for(let t=0;t<this.configurations.length;t++)if(this.configurations[t].key===this.currentIconSet){this.currentConfiguration=this.configurations[t];break}}initIconSet(){if(this.initCurrentConfiguration(),this.currentConfiguration){for(const t in this.currentConfiguration.includeCss)this.loadStylesheet(this.currentConfiguration.includeCss[t]);this.iconsContainer.innerHTML="loading";let e=this;this.loadContainerHtml(this.currentConfiguration.includeHtml).then(function(t){e.iconsContainer.innerHTML=t,e.initFilter()})}else console.warn("BootstrapIconsElement: Could not find a configuration for key "+this.currentIconSet)}loadStylesheet(e){const n=document.querySelectorAll("link");for(let t=0;t<n.length;t++)if(n[t].hasAttribute("href")&&n[t].getAttribute("href")===e)return;let t=document.createElement("link");t.href=e,t.type="text/css",t.rel="stylesheet",t.media="all",document.getElementsByTagName("head")[0].appendChild(t)}loadContainerHtml(t){return new Promise(function(e,n){let i=new XMLHttpRequest;i.open("GET",t,!0),i.onload=function(t){4===i.readyState&&(200===i.status?e(i.response):(n(i),console.error(i.statusText)))},i.send()})}initFilter(){let i=this;if(this.icons=[],"bsicons"===this.currentConfiguration.key){let n=this.iconsContainer.querySelectorAll(".bs-icon");for(var r=0;r<n.length;r++){let t=[],e="";const o=n[r].querySelector(".bs-label"),s=(o&&t.push(o.innerHTML.toLowerCase()),n[r].querySelector(".bi"));s&&(e=s.getAttribute("class").replace("bi ",""),t.push(e.toLowerCase())),t.length&&e&&(this.icons.push({iconElement:n[r],search:t.join(" "),value:e}),n[r].setAttribute("data-bsicon-value",e),n[r].addEventListener("click",function(t){var e=this.getAttribute("data-bsicon-value");e&&(i.currentValue=e,i.updateValues())}))}}this.userControlFilter.addEventListener("keydown",function(){const e=i.userControlFilter.value.toLowerCase();if(e.trim())for(let t=0;t<i.icons.length;t++)-1<i.icons[t].search.indexOf(e)?i.icons[t].iconElement.style.display="inline-block":i.icons[t].iconElement.style.display="none";else for(let t=0;t<i.icons.length;t++)i.icons[t].iconElement.style.display="inline-block"})}createPreviewIcon(){var t;this.previewContainer.innerHTML="â€“",this.currentValue&&this.currentIconSet&&"bsicons"===this.currentIconSet&&(this.previewContainer.innerHTML="",(t=document.createElement("i")).setAttribute("class","bs "+this.currentValue),this.previewContainer.appendChild(t))}}});